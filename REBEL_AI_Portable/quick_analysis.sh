#!/bin/bash
# Tek satır REBEL AI rapor analizi
ZIP="$1"; [[ -z "$ZIP" ]] && { echo "❌ Kullanım: $0 <report.zip>"; exit 1; }; [[ ! -f "$ZIP" ]] && { echo "❌ Zip bulunamadı: $ZIP"; exit 1; }; echo "📦 $ZIP analiz ediliyor..."; TMP=$(mktemp -d); unzip -q "$ZIP" -d "$TMP"; RPT=$(find "$TMP" -name "REBEL_AI_Report_*" -type d | head -1); [[ -z "$RPT" ]] && { echo "❌ Rapor dizini bulunamadı"; rm -rf "$TMP"; exit 1; }; echo -e "\n🚀 REBEL AI RAPOR ANALİZİ - $(basename "$RPT")\n========================================"; echo -e "\n📋 ÖZET RAPOR:"; [[ -f "$RPT/RAPOR_OZETI.txt" ]] && head -30 "$RPT/RAPOR_OZETI.txt" || echo "Özet yok"; echo -e "\n💻 SİSTEM BİLGİSİ:"; [[ -f "$RPT/system/system_info.txt" ]] && head -20 "$RPT/system/system_info.txt" | grep -E "Hostname|OS|CPU|Memory" || echo "Sistem bilgisi yok"; echo -e "\n🧠 AI DATABASE:"; [[ -f "$RPT/data/knowledge.json" ]] && { SIZE=$(stat -c%s "$RPT/data/knowledge.json" 2>/dev/null | numfmt --to=iec || echo "?"); echo "📊 Boyut: $SIZE"; command -v jq >/dev/null && { echo "📈 Platforms: $(jq -r '.command_success_rates | keys | length' "$RPT/data/knowledge.json" 2>/dev/null || echo "?")"; echo "🎯 Device Profiles: $(jq -r '.device_profiles | keys | length' "$RPT/data/knowledge.json" 2>/dev/null || echo "?")"; } || echo "jq yok, JSON parse edilemedi"; } || echo "AI database yok"; echo -e "\n📜 KOMUT GEÇMİŞİ:"; [[ -f "$RPT/logs/commands.log" ]] && { CMDS=$(wc -l < "$RPT/logs/commands.log"); echo "📊 Toplam komut: $CMDS"; echo "🕐 Son 5 komut:"; tail -5 "$RPT/logs/commands.log" | cut -c1-80; } || echo "Komut geçmişi yok"; echo -e "\n🐛 HATA ANALİZİ:"; ERR=0; [[ -d "$RPT/logs" ]] && for f in "$RPT/logs"/*.log; do [[ -f "$f" ]] && E=$(grep -c -i "error\|failed" "$f" 2>/dev/null || echo 0) && [[ $E -gt 0 ]] && { echo "❌ $(basename "$f"): $E hata"; ERR=$((ERR+E)); }; done; [[ $ERR -eq 0 ]] && echo "✅ Hata yok!" || echo "⚠️ Toplam $ERR hata"; echo -e "\n⚡ API DURUMU:"; [[ -f "$RPT/current_status.txt" ]] && grep -E "Server.*responding|status" "$RPT/current_status.txt" | head -3 || echo "API durum bilgisi yok"; HEALTH=0; [[ -f "$RPT/RAPOR_OZETI.txt" ]] && HEALTH=$((HEALTH+1)); [[ -f "$RPT/data/knowledge.json" ]] && HEALTH=$((HEALTH+1)); [[ -f "$RPT/logs/commands.log" ]] && HEALTH=$((HEALTH+1)); [[ -f "$RPT/system/system_info.txt" ]] && HEALTH=$((HEALTH+1)); HP=$((HEALTH*25)); echo -e "\n📊 SAĞLIK SKORU: %$HP"; [[ $HP -ge 75 ]] && echo "🎉 Mükemmel!" || [[ $HP -ge 50 ]] && echo "👍 İyi" || echo "⚠️ Sorunlu"; echo -e "\n========================================"; echo "✅ Analiz tamamlandı!"; rm -rf "$TMP"