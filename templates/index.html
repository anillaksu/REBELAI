<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚ö° REBEL AI CMD Manager</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary-green: #0f0;
            --dark-bg: #111;
            --darker-bg: #000;
            --accent-cyan: #0cf;
            --accent-yellow: #ff0;
            --error-red: #f44;
            --success-green: #4f4;
        }
        
        body { 
            background: var(--dark-bg);
            color: var(--primary-green);
            font-family: 'Courier New', monospace;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background: var(--darker-bg);
            padding: 15px 20px;
            border-bottom: 2px solid var(--primary-green);
            text-align: center;
        }
        
        .header h1 {
            text-shadow: 0 0 10px var(--primary-green);
            margin-bottom: 5px;
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--accent-cyan);
            margin-top: 10px;
        }
        
        .main-container {
            display: flex;
            flex: 1;
            gap: 20px;
            padding: 20px;
        }
        
        .sidebar {
            width: 300px;
            background: var(--darker-bg);
            border: 2px solid var(--primary-green);
            border-radius: 8px;
            padding: 15px;
            max-height: calc(100vh - 160px);
            overflow-y: auto;
        }
        
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .auth-section {
            background: var(--darker-bg);
            border: 2px solid var(--accent-yellow);
            border-radius: 8px;
            padding: 15px;
        }
        
        .command-section {
            background: var(--darker-bg);
            border: 2px solid var(--primary-green);
            border-radius: 8px;
            padding: 15px;
            flex: 1;
        }
        
        .section-title {
            color: var(--accent-cyan);
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        input, button {
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        input {
            width: 100%;
            padding: 8px 12px;
            background: var(--dark-bg);
            color: var(--primary-green);
            border: 1px solid var(--primary-green);
            border-radius: 4px;
            margin-bottom: 10px;
        }
        
        input:focus {
            outline: none;
            box-shadow: 0 0 10px var(--primary-green);
            border-color: var(--accent-cyan);
        }
        
        button {
            padding: 8px 16px;
            background: var(--primary-green);
            color: var(--dark-bg);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            margin: 5px;
        }
        
        button:hover:not(:disabled) {
            background: var(--success-green);
            transform: scale(1.05);
        }
        
        button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background: var(--accent-cyan);
            color: var(--dark-bg);
        }
        
        .btn-danger {
            background: var(--error-red);
            color: white;
        }
        
        .quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin: 10px 0;
        }
        
        .quick-btn {
            padding: 4px 8px;
            font-size: 12px;
            background: var(--accent-cyan);
            color: var(--dark-bg);
        }
        
        #result {
            background: var(--darker-bg);
            padding: 15px;
            border: 2px solid var(--primary-green);
            border-radius: 8px;
            min-height: 300px;
            white-space: pre-wrap;
            font-size: 13px;
            line-height: 1.4;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
            overflow-y: auto;
            max-height: 400px;
        }
        
        .history-item, .favorite-item {
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid var(--primary-green);
            border-radius: 4px;
            padding: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .history-item:hover, .favorite-item:hover {
            background: rgba(0, 255, 0, 0.2);
            border-color: var(--accent-cyan);
        }
        
        .item-command {
            color: var(--accent-cyan);
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .item-meta {
            color: #888;
            font-size: 11px;
        }
        
        .conversion-info {
            color: var(--accent-cyan);
            background: rgba(0, 204, 255, 0.1);
            padding: 10px;
            border-left: 3px solid var(--accent-cyan);
            margin: 10px 0;
            font-style: italic;
        }
        
        .ai-suggestion {
            color: var(--accent-yellow);
            background: rgba(255, 255, 0, 0.1);
            padding: 10px;
            border-left: 3px solid var(--accent-yellow);
            margin: 10px 0;
        }
        
        .loading {
            color: var(--accent-cyan);
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }
        
        .status-message {
            text-align: center;
            margin: 10px 0;
            padding: 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .status-success {
            background: rgba(0, 255, 0, 0.2);
            color: var(--success-green);
            border: 1px solid var(--success-green);
        }
        
        .status-error {
            background: rgba(255, 68, 68, 0.2);
            color: var(--error-red);
            border: 1px solid var(--error-red);
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--primary-green);
            margin-bottom: 15px;
        }
        
        .tab {
            padding: 8px 16px;
            background: transparent;
            border: none;
            color: #888;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }
        
        .tab.active {
            color: var(--primary-green);
            border-bottom-color: var(--primary-green);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .system-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            font-size: 12px;
        }
        
        .stat-item {
            background: rgba(0, 255, 0, 0.1);
            padding: 8px;
            border-radius: 4px;
            text-align: center;
        }
        
        .add-favorite-form {
            display: none;
            background: rgba(0, 204, 255, 0.1);
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
        }
        
        .add-favorite-form input {
            margin-bottom: 5px;
        }
        
        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                max-height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>‚ö° REBEL AI ‚Äì Komut Y√∂neticisi ‚ö°</h1>
        <div class="status-bar">
            <span id="connection-status">üîó Baƒülƒ±</span>
            <span id="ai-status">üß† AI Aktif</span>
            <span id="security-status">üîí G√ºvenli</span>
            <span id="system-time"></span>
        </div>
    </div>
    
    <div class="main-container">
        <div class="sidebar">
            <div class="tabs">
                <button class="tab active" onclick="showTab('history')">Ge√ßmi≈ü</button>
                <button class="tab" onclick="showTab('favorites')">Favoriler</button>
                <button class="tab" onclick="showTab('system')">Sistem</button>
            </div>
            
            <div id="history-tab" class="tab-content active">
                <div class="section-title">üìã Komut Ge√ßmi≈üi</div>
                <div id="history-list">Ge√ßmi≈ü y√ºkleniyor...</div>
            </div>
            
            <div id="favorites-tab" class="tab-content">
                <div class="section-title">‚≠ê Favori Komutlar</div>
                <div style="display: flex; gap: 5px; margin-bottom: 10px;">
                    <button class="btn-secondary" onclick="toggleAddFavorite()">‚ûï Yeni Favori</button>
                    <button class="btn-secondary" onclick="exportFavorites()">üíæ Dƒ±≈üa Aktar</button>
                </div>
                <div class="add-favorite-form" id="add-favorite-form">
                    <input type="text" id="favorite-name" placeholder="Favori adƒ±" />
                    <input type="text" id="favorite-command" placeholder="Komut" />
                    <button onclick="saveFavorite()">Kaydet</button>
                    <button class="btn-danger" onclick="toggleAddFavorite()">ƒ∞ptal</button>
                </div>
                <div id="favorites-list">Favoriler y√ºkleniyor...</div>
            </div>
            
            <div id="system-tab" class="tab-content">
                <div class="section-title">üìä Sistem Bilgileri</div>
                <div id="system-info" class="system-stats">
                    <div class="stat-item">Bilgiler y√ºkleniyor...</div>
                </div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="auth-section">
                <div class="section-title">üîê Kimlik Doƒürulama</div>
                <p style="font-size: 12px; color: #888; margin-bottom: 10px;">
                    üí° √ñnce REBEL_AUTH_TOKEN environment variable'ƒ±nƒ± ayarlayƒ±n
                </p>
                <input id="authToken" type="password" placeholder="Auth token'inizi girin" />
            </div>
            
            <div class="command-section">
                <div class="section-title">üß† Akƒ±llƒ± Komut Terminal</div>
                <p style="margin-bottom: 10px; color: var(--accent-cyan);">
                    PowerShell, CMD ve doƒüal dil komutlarƒ± desteklenir
                </p>
                
                <div class="quick-actions">
                    <button class="quick-btn" onclick="setCommand('ls -la')">üìÅ Dosya Listesi</button>
                    <button class="quick-btn" onclick="setCommand('pwd')">üìç Mevcut Dizin</button>
                    <button class="quick-btn" onclick="setCommand('whoami')">üë§ Kim Benim</button>
                    <button class="quick-btn" onclick="setCommand('uname -a')">üíª Sistem Bilgisi</button>
                    <button class="quick-btn" onclick="setCommand('df -h')">üíæ Disk Alanƒ±</button>
                    <button class="quick-btn" onclick="setCommand('ps aux')">‚öôÔ∏è Procesler</button>
                    <button class="quick-btn" onclick="setCommand('date')">üïê Tarih/Saat</button>
                    <button class="quick-btn" onclick="setCommand('free -h')">üß† Bellek</button>
                </div>
                
                <input id="cmd" placeholder="Komutunuzu yazƒ±n: Get-ChildItem, dir, dosyalarƒ± listele, ls -la..." />
                <div style="display: flex; gap: 10px; margin-top: 10px;">
                    <button onclick="executeCommand()" id="runBtn">‚ö° √áalƒ±≈ütƒ±r</button>
                    <button class="btn-secondary" onclick="clearOutput()">üóëÔ∏è Temizle</button>
                    <button class="btn-secondary" onclick="exportResults()" id="exportBtn">üíæ Ge√ßmi≈ü Dƒ±≈üa Aktar</button>
                </div>
                
                <div id="status" class="status-message" style="display: none;"></div>
                <pre id="result">‚ö° REBEL AI CMD Manager hazƒ±r!
üîê Auth token girin ve komutlarƒ±nƒ±zƒ± √ßalƒ±≈ütƒ±rmaya ba≈ülayƒ±n.
üß† Akƒ±llƒ± √ßeviri: PowerShell, CMD ve T√ºrk√ße komutlar desteklenir.
‚ö° Komutlar otomatik olarak optimize edilir.

üí° Hƒ±zlƒ± ba≈ülangƒ±√ß √∂rnekleri:
‚Ä¢ "Get-ChildItem" ‚Üí ls -la
‚Ä¢ "dir" ‚Üí ls -la  
‚Ä¢ "dosyalarƒ± listele" ‚Üí ls -la
‚Ä¢ "kim benim" ‚Üí whoami</pre>
            </div>
        </div>
    </div>

    <script>
        let isRunning = false;
        let authToken = '';
        let lastResults = [];
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateClock();
            setInterval(updateClock, 1000);
            document.getElementById("cmd").focus();
            
            // Load initial data
            setTimeout(() => {
                loadHistory();
                loadFavorites();
                loadSystemInfo();
            }, 1000);
        });
        
        function updateClock() {
            document.getElementById('system-time').textContent = new Date().toLocaleTimeString();
        }
        
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
            
            // Load data for the tab
            if (tabName === 'history') loadHistory();
            else if (tabName === 'favorites') loadFavorites();
            else if (tabName === 'system') loadSystemInfo();
        }
        
        async function loadHistory() {
            try {
                const token = document.getElementById('authToken').value;
                if (!token) return;
                
                const response = await fetch('/api/history', {
                    headers: { 'X-Auth-Token': token }
                });
                
                if (response.ok) {
                    const history = await response.json();
                    displayHistory(history);
                }
            } catch (error) {
                console.error('History load error:', error);
            }
        }
        
        function displayHistory(history) {
            const container = document.getElementById('history-list');
            if (history.length === 0) {
                container.innerHTML = '<div style="color: #888; text-align: center;">Hen√ºz komut ge√ßmi≈üi yok</div>';
                return;
            }
            
            container.innerHTML = history.map(item => `
                <div class="history-item" onclick="setCommand('${item.command.replace(/'/g, "\\'")}')">
                    <div class="item-command">${item.command}</div>
                    <div class="item-meta">${item.summary} ‚Ä¢ ${new Date(item.timestamp).toLocaleString()}</div>
                </div>
            `).join('');
        }
        
        async function loadFavorites() {
            try {
                const token = document.getElementById('authToken').value;
                if (!token) return;
                
                const response = await fetch('/api/favorites', {
                    headers: { 'X-Auth-Token': token }
                });
                
                if (response.ok) {
                    const favorites = await response.json();
                    displayFavorites(favorites);
                }
            } catch (error) {
                console.error('Favorites load error:', error);
            }
        }
        
        function displayFavorites(favorites) {
            const container = document.getElementById('favorites-list');
            if (favorites.length === 0) {
                container.innerHTML = '<div style="color: #888; text-align: center;">Hen√ºz favori komut yok</div>';
                return;
            }
            
            container.innerHTML = favorites.map(item => `
                <div class="favorite-item" onclick="setCommand('${item.command.replace(/'/g, "\\'")}')">
                    <div class="item-command">${item.name}</div>
                    <div style="color: var(--accent-cyan); font-size: 12px;">${item.command}</div>
                    <div class="item-meta">${new Date(item.timestamp).toLocaleString()}</div>
                </div>
            `).join('');
        }
        
        async function loadSystemInfo() {
            try {
                const token = document.getElementById('authToken').value;
                if (!token) return;
                
                const response = await fetch('/api/system-info', {
                    headers: { 'X-Auth-Token': token }
                });
                
                if (response.ok) {
                    const info = await response.json();
                    displaySystemInfo(info);
                }
            } catch (error) {
                console.error('System info load error:', error);
            }
        }
        
        function displaySystemInfo(info) {
            const container = document.getElementById('system-info');
            container.innerHTML = `
                <div class="stat-item">
                    <div style="color: var(--accent-cyan);">ƒ∞zinli Komutlar</div>
                    <div>${info.allowed_commands}</div>
                </div>
                <div class="stat-item">
                    <div style="color: var(--error-red);">Engelli Komutlar</div>
                    <div>${info.blocked_commands}</div>
                </div>
                <div class="stat-item">
                    <div style="color: var(--accent-yellow);">AI Durumu</div>
                    <div>${info.ai_enabled ? '‚úÖ Aktif' : '‚ùå Pasif'}</div>
                </div>
                <div class="stat-item">
                    <div style="color: var(--primary-green);">Ge√ßmi≈ü</div>
                    <div>${info.history_count} komut</div>
                </div>
                <div class="stat-item" style="grid-column: 1 / -1;">
                    <div style="color: var(--accent-cyan);">Sistem Zamanƒ±</div>
                    <div>${new Date(info.uptime).toLocaleString()}</div>
                </div>
            `;
        }
        
        function setCommand(command) {
            document.getElementById('cmd').value = command;
            document.getElementById('cmd').focus();
        }
        
        function toggleAddFavorite() {
            const form = document.getElementById('add-favorite-form');
            form.style.display = form.style.display === 'none' ? 'block' : 'none';
        }
        
        async function saveFavorite() {
            const name = document.getElementById('favorite-name').value.trim();
            const command = document.getElementById('favorite-command').value.trim();
            const token = document.getElementById('authToken').value;
            
            if (!name || !command) {
                showStatus('Ad ve komut gerekli', 'error');
                return;
            }
            
            try {
                const response = await fetch('/api/favorites', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Auth-Token': token
                    },
                    body: JSON.stringify({ name, command })
                });
                
                if (response.ok) {
                    showStatus('Favori kaydedildi', 'success');
                    document.getElementById('favorite-name').value = '';
                    document.getElementById('favorite-command').value = '';
                    toggleAddFavorite();
                    loadFavorites();
                } else {
                    showStatus('Favori kaydedilemedi', 'error');
                }
            } catch (error) {
                showStatus('Hata olu≈ütu', 'error');
            }
        }
        
        // Allow Enter key to run commands
        document.getElementById("cmd").addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                executeCommand();
            }
        });
        
        function showStatus(message, type) {
            const statusEl = document.getElementById("status");
            statusEl.textContent = message;
            statusEl.className = `status-message status-${type}`;
            statusEl.style.display = "block";
            
            if (type === "success") {
                setTimeout(() => {
                    statusEl.style.display = "none";
                }, 3000);
            }
        }
        
        async function executeCommand() {
            if (isRunning) return;
            
            const cmdInput = document.getElementById("cmd");
            const authInput = document.getElementById("authToken");
            const runBtn = document.getElementById("runBtn");
            const resultEl = document.getElementById("result");
            
            const cmd = cmdInput.value.trim();
            authToken = authInput.value.trim();
            
            if (!authToken) {
                showStatus("L√ºtfen auth token girin", "error");
                return;
            }
            
            if (!cmd) {
                showStatus("L√ºtfen bir komut girin", "error");
                return;
            }
            
            // Set loading state
            isRunning = true;
            runBtn.disabled = true;
            runBtn.textContent = "‚è≥ √áalƒ±≈ütƒ±rƒ±lƒ±yor...";
            resultEl.textContent = "Komutlar √ßalƒ±≈ütƒ±rƒ±lƒ±yor...\n";
            resultEl.className = "loading";
            
            try {
                const response = await fetch("/run", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "X-Auth-Token": authToken
                    },
                    body: JSON.stringify({ command: cmd })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                lastResults = data;
                
                // Build output
                let output = "";
                
                // Show conversion info first if available
                if (data.length > 0 && data[0].conversion_info) {
                    output += `üß† Komut √áevirisi: ${data[0].conversion_info}\n`;
                    output += "=".repeat(60) + "\n\n";
                }
                
                data.forEach((result, index) => {
                    output += `‚ñ∂ ${result.cmd}\n`;
                    output += `√áƒ±ktƒ±:\n${result.output}\n`;
                    
                    if (result.fix) {
                        output += `üí° AI √ñneri:\n${result.fix}\n`;
                    }
                    
                    if (index < data.length - 1) {
                        output += "\n" + "=".repeat(50) + "\n\n";
                    }
                });
                
                resultEl.textContent = output;
                resultEl.className = "";
                showStatus("Komutlar ba≈üarƒ±yla √ßalƒ±≈ütƒ±rƒ±ldƒ±", "success");
                
                // Clear input and refresh data
                cmdInput.value = "";
                setTimeout(() => {
                    loadHistory();
                    loadSystemInfo();
                }, 500);
                
            } catch (error) {
                resultEl.textContent = `‚ùå Hata olu≈ütu: ${error.message}`;
                resultEl.className = "";
                showStatus("Komut √ßalƒ±≈ütƒ±rma hatasƒ±", "error");
            } finally {
                // Reset loading state
                isRunning = false;
                runBtn.disabled = false;
                runBtn.textContent = "‚ö° √áalƒ±≈ütƒ±r";
            }
        }
        
        function clearOutput() {
            document.getElementById('result').textContent = "‚ö° Terminal temizlendi. Yeni komutlarƒ±nƒ±zƒ± bekliyor...";
            lastResults = [];
        }
        
        async function exportResults() {
            const token = document.getElementById('authToken').value;
            if (!token) {
                showStatus("Export i√ßin auth token gerekli", "error");
                return;
            }
            
            try {
                // Export history
                const response = await fetch('/api/export?type=history', {
                    headers: { 'X-Auth-Token': token }
                });
                
                if (response.ok) {
                    const blob = await response.blob();
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `rebel-ai-history-${new Date().toISOString().slice(0,10)}.txt`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    showStatus("Ge√ßmi≈ü ba≈üarƒ±yla dƒ±≈üa aktarƒ±ldƒ±", "success");
                } else {
                    showStatus("Export hatasƒ±", "error");
                }
            } catch (error) {
                showStatus("Export hatasƒ±: " + error.message, "error");
            }
        }
        
        async function exportFavorites() {
            const token = document.getElementById('authToken').value;
            if (!token) {
                showStatus("Export i√ßin auth token gerekli", "error");
                return;
            }
            
            try {
                const response = await fetch('/api/export?type=favorites', {
                    headers: { 'X-Auth-Token': token }
                });
                
                if (response.ok) {
                    const blob = await response.blob();
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `rebel-ai-favorites-${new Date().toISOString().slice(0,10)}.txt`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    showStatus("Favoriler ba≈üarƒ±yla dƒ±≈üa aktarƒ±ldƒ±", "success");
                } else {
                    showStatus("Export hatasƒ±", "error");
                }
            } catch (error) {
                showStatus("Export hatasƒ±: " + error.message, "error");
            }
        }
    </script>
</body>
</html>